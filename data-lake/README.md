# Sparkify S3 Data lake Project
The objective of this project is build an place to consolidate the sparkify data generated by it users, in specific all the actions when the users click **nextSong**. 
The data lake is structured by the following entities:
- Songplays (partitioned by year and month) : s3://{bucket}/data-lake/songplays/{year-partition}/{month-partition}/
- Users : s3://{bucket}/data-lake/users
- Songs (partitioned by year and artist_id) : s3://{bucket}/data-lake/songs/{year-partition}/{artist-partition}/
- Artists : s3://{bucket}/data-lake/artists
- Time (partitioned by year and month) : s3://{bucket}/data-lake/time/{year-partition}/{month-partition}/

# About the Data Model and ETL
Please find next the data dictonary for all the tables in the final desing:

## Songplays Fact Table
| Column name | Source              | Comment                                                                                   |
|-------------|---------------------|-------------------------------------------------------------------------------------------|
| songplay_id | Autogenerated       |                                                                                           |
| start_time  | log_data.ts         | Pointing to table time.start_time                                                         |
| user_id     | log_data.userId     | Pointing to table users.user_id                                                           |
| level       | log_data.level      |                                                                                           |
| song_id     | song_data.song_id   | song_id matching title, artist name of a song                                             |
| artist_id   | song_data.artist_id | artist_id matching title, artist name of a song                                           |
| session_id  | log_data.session_id |                                                                                           |
| location    | log_data.location   |                                                                                           |
| user_agent  | log_data.user_agent |                                                                                           |

## Users Dimension
| Column name | Source             | Comment     |
|-------------|--------------------|-------------|
| user_id     | log_data.userId    |             |
| first_name  | log_data.firstName |             |
| last_name   | log_data.lastName  |             |
| gender      | log_data.gender    |             |
| level       | log_data.level     |             |

### Uniqueness Policy
The process is getting the distinct rows.

## Songs Dimension
| Column name | Source              | Comment                                                  |
|-------------|---------------------|----------------------------------------------------------|
| song_id     | song_data.song_id   |                                                          |
| title       | song_data.title     |                                                          |
| artist_id   | song_data.artist_id | Pointing to artists.artist_id                            |
| year        | song_data.year      |                                                          |
| duration    | song_data.duration  |                                                          |

## Artists Dimension
| Column name | Source                     | Comment     |
|-------------|----------------------------|-------------|
| artist_id   | song_data.artist_id        |             |
| name        | song_data.artist_name      |             |
| location    | song_data.artist_location  |             |
| latitude    | song_data.artist_latitude  |             |
| longitude   | song_data.artist_longitude |             |

### Uniqueness Policy
The process is getting the last distinct rows.

## Time Dimension
| Column name | Source      | Comment     |
|-------------|-------------|-------------|
| start_time  | log_data.ts |             |
| hour        | log_data.ts |             |
| day         | log_data.ts |             |
| week        | log_data.ts |             |
| month       | log_data.ts |             |
| year        | log_data.ts |             |
| weekday     | log_data.ts |             |

### Uniqueness Policy
Getting distinct values

## About files:
- etl.py: Contains the complete script for process all the files.

- dl.cfg: Configuration file, contains all the parameters used in the scripts

## How to run
Execute etl script
>python etl.py

## Final Notes:
All the types are inferred by spark.
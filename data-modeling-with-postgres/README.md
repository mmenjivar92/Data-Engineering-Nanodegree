# Sparkify Project 1
The objective of this project is provide an easy place to run queries over the sparkify data generated by it users, in specific all the actions when the users click **nextSong**.
In business terms, enables the data analysts to build insights based on the customers behaviour, know trending artist, trending songs and user activity. This could be use for recommenders in order to offer a personalized experience to the customers.
# About the Data Model and ETL
Please find next the data dictonary for all the tables in the final desing:

## Songplays Fact Table
| Column name | Type    | Source              | Comment                                                       |
|-------------|---------|---------------------|---------------------------------------------------------------|
| songplay_id | serial  | Autogenerated       |                                                               |
| start_time  | bigint  | log_data.ts         | Pointing to table time.start_time                             |
| user_id     | int     | log_data.userId     | Pointing to table users.user_id                               |
| level       | varchar | log_data.level      |                                                               |
| song_id     | varchar | song_data.song_id   | song_id matching title, artist name, and duration of a song   |
| artist_id   | varchar | song_data.artist_id | artist_id matching title, artist name, and duration of a song |
| session_id  | int     | log_data.session_id |                                                               |
| location    | varchar | log_data.location   |                                                               |
| user_agent  | varchar | log_data.user_agent |                                                               |

## Users Dimension
| Column name | Type    | Source             | Comment     |
|-------------|---------|--------------------|-------------|
| user_id     | int     | log_data.userId    | Primary key |
| first_name  | varchar | log_data.firstName |             |
| last_name   | varchar | log_data.lastName  |             |
| gender      | varchar | log_data.gender    |             |
| level       | varchar | log_data.level     |             |

### Upsert Policy
The process is updating the columns with the last appearence of the user.

## Songs Dimension
| Column name | Type    | Source              | Comment                       |
|-------------|---------|---------------------|-------------------------------|
| song_id     | varchar | song_data.song_id   | Primary key                   |
| title       | varchar | song_data.title     |                               |
| artist_id   | varchar | song_data.artist_id | Pointing to artists.artist_id |
| year        | int     | song_data.year      |                               |
| duration    | real    | song_data.duration  |                               |

### Upsert Policy
The process is updating the columns with the last appearence of the song.

## Artists Dimension
| Column name | Type    | Source                     | Comment     |
|-------------|---------|----------------------------|-------------|
| artist_id   | varchar | song_data.artist_id        | Primary key |
| name        | varchar | song_data.artist_name      |             |
| location    | varchar | song_data.artist_location  |             |
| latitude    | real    | song_data.artist_latitude  |             |
| longitude   | real    | song_data.artist_longitude |             |

### Upsert Policy
On conflict, the process is refreshing the columns with the last appearence of the artist.

## Time Dimension
| Column name | Type      | Source      | Comment     |
|-------------|-----------|-------------|-------------|
| start_time  | timestamp | log_data.ts | Primary key |
| hour        | int       | log_data.ts |             |
| day         | int       | log_data.ts |             |
| week        | int       | log_data.ts |             |
| month       | int       | log_data.ts |             |
| year        | int       | log_data.ts |             |
| weekday     | int       | log_data.ts |             |

### Upsert Policy
No update on conflict (because the values are not going to change).

## About files:
- sql_queries.py: Contains all the extraction queries and insert queries used in the etl.

- create_tables.py: Contains the python script to execute the postgres drop/creation actions.

- etl.ipynb: Contains the prototype of the etl process.

- etl.py: Contains the complete script for process all the files.

- test.ipynb: Contanis some test queries to be executed after the load of the model.

## How to run
Execute the creation tables script
>python create_tables.py

Execute etl script
>python etl.py
